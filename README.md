# Утилита для работы с файлами

Простая утилита командной строки, написанная на Go, для обработки данных о странах из файлов CSV или JSON. Поддерживает чтение входных файлов, применение фильтров и сортировки, а также вывод результатов в консоль или новый файл в формате CSV/JSON. Этот проект направлен на отработку навыков работы с файлами, аргументами командной строки, обработкой JSON/CSV, структурами и модульным тестированием.

## Возможности

- **Форматы ввода**: Поддержка файлов CSV и JSON, содержащих данные о странах (название, население, площадь).
- **Операции**:
  - Фильтрация: По критерию `поле=значение` (например, `name=Russia`, `population=100000000` для минимального населения, `area=1000000` для минимальной площади).
  - Сортировка: По полю (например, `name`, `population`, `area`) в порядке убывания.
- **Вывод**: В консоль (по умолчанию) или в новый файл CSV/JSON.
- **Валидация**: Проверка пустых файлов, некорректных форматов, отрицательных значений и т.д.
- **Тестирование**: Включает модульные тесты для чтения/записи файлов, фильтрации, сортировки и обработки краевых случаев.
- **Сборка**: Makefile для сборки, тестирования и очистки.
- **Docker**: Поддержка запуска в Docker-контейнере.

## Установка

1. Убедитесь, что установлен Go (версия 1.21 или выше).
2. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/DaniilMarkow/FileUtilityTool.git
   cd FileUtilityTool
   ```
3. Соберите исполняемый файл:
   ```bash
   make build
   ```
   Это создаст исполняемый файл с именем `fileutil`.

## Использование с Docker

1. Создайте Docker-образ:
   ```bash
   docker build -t fileutil .
   ```
2. Запустите контейнер, передав флаги через командную строку:
   ```bash
   docker run --rm -v $(pwd)/testdata:/app/testdata fileutil -input=/app/testdata/test1.csv -sort=population
   ```
3. Для вывода в файл используйте тома Docker:
   ```bash
   docker run --rm -v $(pwd)/output:/app/output fileutil -input=/app/testdata/test1.csv -output=/app/output/result.json -filter=area=10000000
   ```

**Примечание**: Убедитесь, что папка `testdata` и файлы доступны в контейнере через монтирование томов.

## Использование

Запустите утилиту с флагами для указания входного файла, выходного файла, фильтров и сортировки:

```bash
./fileutil -input=<входной-файл> [-output=<выходной-файл>] [-filter=<поле=значение>] [-sort=<поле>]
```

### Флаги

| Флаг           | Описание                                                                |
|----------------|-------------------------------------------------------------------------|
| `-input`       | Путь к входному файлу (CSV или JSON)                                    |
| `-output`      | Путь к выходному файлу (CSV или JSON). Если не указан, вывод в консоль  |
| `-filter`      | Критерий фильтрации в формате `поле=значение` (name, population, area)  |
| `-sort`        | Поле для сортировки (в порядке убывания): `name`, `population`, `area`  | 

**Поддерживаемые поля для фильтрации**:
- `name`: Точное совпадение.
- `population`: Минимальное значение (страны с населением >= значения).
- `area`: Минимальное значение (страны с площадью >= значения).

### Примеры

1. **Чтение CSV, сортировка по населению, вывод в консоль**:
   ```bash
   ./fileutil -input=testdata/test1.csv -sort=population
   ```
   Вывод:
   ```
   Результат:
   1. USA: 295700000 (9629091)
   2. Россия: 143400000 (17075200)
   3. Япония: 127400000 (377835)
   4. Франция: 68860000 (549190)
   ```

2. **Фильтрация по минимальной площади, вывод в JSON**:
   ```bash
   ./fileutil -input=testdata/test1.csv -filter=area=10000000 -output=output.json
   ```

3. **Фильтрация по названию, сортировка по площади**:
   ```bash
   ./fileutil -input=testdata/test2.json -filter=name=Россия -sort=area
   ```

4. **Использование Makefile для быстрого запуска**:
   ```bash
   make all INPUT_FILE=testdata/test1.csv OUTPUT_FILE=result.json
   ```

## Структура проекта

- `main.go`: Точка входа, разбор флагов, валидация и основная логика.
- `processor.go`: Функции для чтения/записи CSV/JSON, фильтрации и сортировки.
- `types.go`: Определение структуры `Country`.
- `processor_test.go`: Модульные тесты с использованием `testing` и `github.com/stretchr/testify/assert`.
- `Makefile`: Цели для `build`, `test`, `clean` и `all` (сборка и выполнение примера).
- `testdata/`: Примерные файлы: `test1.csv`, `test2.json`, `filtered.csv`, `sorted.json`.
- `Dockerfile`: Конфигурация для запуска в Docker.

## Тестирование

Запустите модульные тесты с покрытием:
```bash
make test
```

Это выполнит:
- Очистку кэша тестов.
- Запуск тестов и генерацию профиля покрытия.
- Создание HTML-отчета о покрытии в `coverage/report.html`.

Тесты охватывают:
- Чтение файлов (CSV/JSON, пустые/некорректные файлы).
- Запись файлов (CSV/JSON).
- Логику фильтрации и сортировки.
- Краевые случаи, такие как некорректные записи.

## Зависимости

- **Стандартные библиотеки Go**: `flag`, `fmt`, `log`, `strings`, `encoding/csv`, `encoding/json`, `os`, `strconv`, `sort`.
- **Для тестирования**: `testing`, `path/filepath`, `github.com/stretchr/testify/assert`.

## Ограничения

- Сортировка выполняется только в порядке убывания.
- Фильтрация для `population` и `area` основана на минимальном значении (>=); для `name` — точное совпадение.
- Нет поддержки сортировки по возрастанию или сложных фильтров.
- Предполагается, что входные данные корректны; при некорректных данных возвращаются ошибки.

## Вклад в проект

Приветствуются любые предложения, исправления ошибок или новые функции через issues или pull requests.
